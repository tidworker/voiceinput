<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>中文點餐系統</title>
  <style>
    /* 防止下拉刷新 */
    html, body {
      overscroll-behavior: none;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      padding: 0;
      background-color: black;
      color: white;
      text-align: center;
      user-select: none;
    }
    /* 圖片（logo或標題） */
    img {
      max-width: 100%;
    }
    /* 主要內容區：訂單表格與備忘錄顯示 */
    #contentContainer {
      width: 90%;
      height: 370px;
      margin: 20px auto;
      overflow-y: auto;
      background-color: black;
    }
    /* 訂單表格 */
    table {
      width: 100%;
      background-color: black;
      color: white;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 3px;
    }
    table, th, td {
      border: 0;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    table th {
      background-color: orange;
      color: black;
    }
    thead tr th:first-child {
      border-top-left-radius: 3px;
    }
    thead tr th:last-child {
      border-top-right-radius: 3px;
    }
    /* 備忘錄顯示區：文字橘色，可點擊編輯 */
    #voiceOutput {
      margin-top: 10px;
      text-align: left;
      color: orange;
      padding: 10px;
      cursor: pointer;
      background-color: black;
    }
    /* 總金額 */
    #totalAmount {
      color: white;
      font-size: 18px;
      margin-top: 10px;
    }
    /* 按鈕 */
    button {
      background-color: black;
      border: none;
      cursor: pointer;
      width: 50px;
      height: 50px;
      padding: 0;
      margin-top: 5px;
      font-weight: bold;
    }
    /* 模態框（編輯訂單或備忘錄） */
    #editModal, #memoModal {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
    }
    #editModalContent, #memoModalContent {
      background: #fff;
      color: black;
      margin: 10% auto;
      padding: 20px;
      width: 300px;
      border-radius: 5px;
    }
    /* 備忘錄模態框較大 */
    #memoModalContent {
      width: 80%;
      max-width: 400px;
    }
    #memoInput {
      width: 100%;
      height: 100px;
    }
    .modal-btn {
      background-color: black;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
    }
    /* 下拉選單（備註編輯用） */
    #modalFreeSelectContainer {
      display: none;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <!-- 頁首圖片 -->
  <br />
  <img src="3.png" width="340" height="170" alt="Logo">
  <!-- 訂單與備忘錄顯示區 -->
  <div id="contentContainer">
    <table id="orderTable">
      <thead>
        <tr>
          <th>品項</th>
          <th>份數</th>
          <th>備註</th>
          <th>單價</th>
        </tr>
      </thead>
      <tbody>
        <!-- 訂單項目將由程式碼動態插入 -->
      </tbody>
    </table>
    <div id="voiceOutput" onclick="openMemoModal()">點此編輯備忘錄</div>
  </div>
  <p id="totalAmount">總金額：0 元</p>
  <!-- 功能按鈕 -->
  <button id="resetButton" onclick="resetOrder()"><img src="re.png" width="50" height="50" alt="重置"></button>
  <button id="ordersLinkButton" onclick="window.location.href='orders.html'"><img src="list.png" width="50" height="50" alt="訂單紀錄"></button>
  <button id="completeOrderButton" onclick="completeOrder()"><img src="order.png" width="50" height="50" alt="完成訂單"></button>
  
  <!-- 編輯訂單模態框（略） -->
  <div id="editModal">
    <div id="editModalContent">
      <h3 id="modalDishName">編輯品項</h3>
      <div id="modalFreeSelectContainer">
        <label for="modalFreeSelect">選擇備註項目:</label>
        <select id="modalFreeSelect"></select>
      </div>
      <label for="modalQuantity">份數:</label>
      <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0;">
        <button class="modal-btn" onclick="modalDecreaseQuantity()">-</button>
        <input type="number" id="modalQuantity" min="1" style="width:60px; text-align:center; margin: 0 10px;" value="1"/>
        <button class="modal-btn" onclick="modalIncreaseQuantity()">+</button>
      </div>
      <div style="margin-top:10px;">
        <button class="modal-btn" onclick="saveModal()">儲存</button>
        <button class="modal-btn" onclick="deleteModal()">刪除</button>
        <button class="modal-btn" onclick="closeModal()">取消</button>
      </div>
    </div>
  </div>
  
  <!-- 備忘錄模態框 -->
  <div id="memoModal">
    <div id="memoModalContent">
      <h3>編輯備忘錄</h3>
      <textarea id="memoInput"></textarea>
      <br>
      <button class="modal-btn" onclick="saveMemo()">儲存</button>
      <button class="modal-btn" onclick="clearMemo()">清除</button>
      <button class="modal-btn" onclick="closeMemoModal()">取消</button>
    </div>
  </div>
  
  <script>
    /*==================== 主頁訂單功能 ====================*/
    let orderHistory = [];
    
    // (這裡省略部分訂單處理與語音功能程式碼，您可依需求擴充)
    function resetOrder() {
      document.getElementById("orderTable").getElementsByTagName("tbody")[0].innerHTML = "";
      document.getElementById("totalAmount").innerText = "總金額：0 元";
      document.getElementById("voiceOutput").innerText = "點此編輯備忘錄";
      localStorage.removeItem("currentOrderData");
    }
    function completeOrder() {
      // 完成訂單動作範例
      alert("訂單已完成！");
      resetOrder();
    }
    
    // ----------------- 備忘錄模態框 -----------------
    function openMemoModal() {
      const memoModal = document.getElementById("memoModal");
      const memoInput = document.getElementById("memoInput");
      memoInput.value = document.getElementById("voiceOutput").innerText;
      memoModal.style.display = "block";
    }
    function closeMemoModal() {
      document.getElementById("memoModal").style.display = "none";
    }
    function saveMemo() {
      const newMemo = document.getElementById("memoInput").value;
      document.getElementById("voiceOutput").innerText = newMemo;
      closeMemoModal();
    }
    function clearMemo() {
      document.getElementById("memoInput").value = "";
      document.getElementById("voiceOutput").innerText = "";
    }
    
    // ----------------- 連點三下重新整理 -----------------
    let tapCount = 0;
    let lastTapTime = 0;
    document.addEventListener("click", function(e) {
      // 僅當點擊發生在螢幕下半部 25% 區域
      if (e.clientY < window.innerHeight * 0.75) return;
      let now = Date.now();
      if (now - lastTapTime < 1000) {
        tapCount++;
      } else {
        tapCount = 1;
      }
      lastTapTime = now;
      if (tapCount >= 3) {
        location.reload();
      }
    });
    
    /*==================== 手勢控制 ====================*/
    let leftSwipeStartX = null;
    let leftSwipeStartTime = null;
    
    // 左滑觸發：必須滿足水平位移超過 90px 且持續時間 < 1000 毫秒
    function onLeftSwipe() {
      // 您可以在此執行左滑後的動作（例如切換頁面內容、顯示動畫等）
      alert("左滑換頁觸發！");
    }
    
    document.addEventListener("touchstart", function(e) {
      if (e.touches.length === 1) {
        leftSwipeStartX = e.touches[0].clientX;
        leftSwipeStartTime = Date.now();
      }
    });
    
    document.addEventListener("touchend", function(e) {
      if (leftSwipeStartX === null) return;
      const endX = e.changedTouches[0].clientX;
      const deltaX = endX - leftSwipeStartX;
      const duration = Date.now() - leftSwipeStartTime;
      // 條件：左滑（deltaX < -90）且持續時間 < 1000 毫秒
      if (deltaX < -90 && duration < 1000) {
        onLeftSwipe();
      }
      leftSwipeStartX = null;
      leftSwipeStartTime = null;
    });
    
    // -------------------- 強制重置手勢狀態（載入時） --------------------
    function resetGlobalGestureState() {
      leftSwipeStartX = null;
      leftSwipeStartTime = null;
      // 其他全域手勢變數（例如全域右滑等）亦在此重置
    }
    window.addEventListener("load", resetGlobalGestureState);
    
    /*==================== 此處可加入其他訂單與語音處理邏輯 ====================*/
    
  </script>
</body>
</html>