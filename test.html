<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>點餐系統</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: white;
      color: black;
      height: 100%;
      user-select: none;
    }
    #orderTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 6px;
      text-align: left;
    }
    #totalAmount {
      margin: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <table id="orderTable">
    <thead>
      <tr>
        <th>品項</th>
        <th>份數</th>
        <th>備註</th>
        <th>單價</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="totalAmount">總金額：0 元</p>

  <script>
    let menu = [
      { keywords: ["chonyobin", "bujiadan", "bujia"], name: "蔥油餅", price: 20 },
      { keywords: ["chonyobinjiadan", "danbin", "jiadan", "la"], name: "蔥油餅加蛋", price: 30 },
      { keywords: ["la"], name: "辣", price: 0 }
    ];

    function addOrderRow(dish, quantity, remark) {
      if (!dish) return;
      const tbody = document.querySelector("#orderTable tbody");
      const row = tbody.insertRow();
      row.insertCell().innerText = dish.name;
      row.insertCell().innerText = quantity;
      row.insertCell().innerText = remark;
      row.insertCell().innerText = dish.price;
      updateTotalAmount();
    }

    function updateTotalAmount() {
      const tbody = document.querySelector("#orderTable tbody");
      let total = 0;
      [...tbody.rows].forEach(row => {
        const qty = parseInt(row.cells[1].innerText);
        const price = parseInt(row.cells[3].innerText);
        total += qty * price;
      });
      document.getElementById("totalAmount").innerText = "總金額：" + total + " 元";
    }

    function resetOrder() {
      document.querySelector("#orderTable tbody").innerHTML = "";
      document.getElementById("totalAmount").innerText = "總金額：0 元";
    }

    function startVoiceInput() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "zh-TW";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.onresult = e => {
        const transcript = e.results[0][0].transcript;
        const result = processInput(transcript.trim());
        result.forEach(o => addOrderRow(o.dish, o.quantity, ""));
      };
      recognition.onerror = () => {};
      recognition.start();
    }

    function processInput(inputText) {
      const tokens = inputText.split(/和|、|跟| /).filter(t => t);
      const result = [];
      tokens.forEach(token => {
        const match = token.match(/^(.+?)(\d+)$/);
        const name = match ? match[1] : token;
        const qty = match ? parseInt(match[2]) : 1;
        const dish = menu.find(item => item.keywords.includes(name.toLowerCase()));
        if (dish) result.push({ dish, quantity: qty });
      });
      return result;
    }

    let timer = null;
    let longPress = false;

    document.body.addEventListener("touchstart", () => {
      longPress = false;
      timer = setTimeout(() => {
        longPress = true;
        resetOrder();
      }, 800);
    });

    document.body.addEventListener("touchend", () => {
      clearTimeout(timer);
      if (!longPress) startVoiceInput();
    });
  </script>
</body>
</html>